<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics View</title>
    <style>
        body {
            background-color: black;
            color: lightgreen;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 16px;
        }
        table {
            width: 50%;
            border-collapse: collapse;
            margin: 20px auto;
            border: 1px solid red;
            color: black;
            font-family: Arial, sans-serif;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
            width: 60px;
            font-weight: bold;
        }
        th {
            color: white;
        }
        /* Updated row content background color */
        td {
            background-color: lightyellow;
        }
        /* Custom styles for specific headers */
        th:nth-child(2) {
            background-color: green; /* Cluster 0 */
        }
        th:nth-child(3) {
            background-color: green; /* Cluster 00 */
        }
        th:nth-child(4) {
            background-color: red; /* High Hits */
        }
        /* Blue background for the first column with white text */
        td:first-child {
            background-color: blue;
            color: white;
        }
        /* Gray background for the first column header */
        th:first-child {
            background-color: gray;
        }
    </style>
</head>
<body>
    <h1>Stats from CSV Data</h1>
    <table id="statsTable">
        <thead></thead>
        <tbody></tbody>
    </table>
    <script>
        if (localStorage.getItem('clearTable') === 'true') {
            localStorage.removeItem('clearTable');  // Remove the flag
            document.querySelector('#statsTable thead').innerHTML = '';
            document.querySelector('#statsTable tbody').innerHTML = '';
        }

        // Retrieve the CSV data from localStorage
        const csvData = JSON.parse(localStorage.getItem('csvData'));
        const columnOrder = ['18', '6', '21', '33', '16', '4', '23', '35', '14', '2', '0', '28', '9', '26', '30', '11', '7', '20', '32', 
                                '17', '5', '22', '34', '15', '3', '24', '36', '13', '1', '00', '27', '10', '25', '29', '12', '8', '19', '31'];
        const group1Columns = ['0', '9', '14', '28', '2'];
        const group2Columns = ['1', '13', '27', '10', '00'];

        let statsData = {
            highHits: { 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0 },
            group1: { 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0 },
            group2: { 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0 }
        };

        if (csvData) {
            const table = document.getElementById('statsTable');
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');

            // Create the header row
            const header = ["", "Cluster 0", "Cluster 00", "High Hits"];
            const trHeader = document.createElement('tr');
            header.forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                trHeader.appendChild(th);
            });
            thead.appendChild(trHeader);

            // Process each row in csvData
            csvData.forEach(row => {
                let group1Sum = 0;
                let group2Sum = 0;

                columnOrder.forEach((header, index) => {
                    const cellValue = row[index];
                    if (!isNaN(cellValue) && cellValue !== '') {
                        const numValue = Number(cellValue);
                        if (group1Columns.includes(header)) {
                            group1Sum += numValue;
                        }
                        if (group2Columns.includes(header)) {
                            group2Sum += numValue;
                        }
                        if ([5, 6, 7, 8, 9, 10, 11].includes(numValue)) {
                            statsData.highHits[numValue] += 1;
                        }
                    }
                });

                console.log(`Row data: ${JSON.stringify(row)}`);
                console.log(`Group1Sum: ${group1Sum}, Group2Sum: ${group2Sum}`);

                if ([5, 6, 7, 8, 9, 10, 11].includes(group1Sum)) {
                    statsData.group1[group1Sum] += 1;
                }
                if ([5, 6, 7, 8, 9, 10, 11].includes(group2Sum)) {
                    statsData.group2[group2Sum] += 1;
                }
            });

            console.log(`Stats data after processing: ${JSON.stringify(statsData)}`);

            // Create rows for each "5" to "11"
            for (let i = 5; i <= 11; i++) {
                const tr = document.createElement('tr');
                const tdValue = document.createElement('td');
                tdValue.textContent = i;
                tr.appendChild(tdValue);

                // Cluster 0
                const tdGroup1 = document.createElement('td');
                tdGroup1.textContent = statsData.group1[i] || 0;
                tr.appendChild(tdGroup1);

                // Cluster 00
                const tdGroup2 = document.createElement('td');
                tdGroup2.textContent = statsData.group2[i] || 0;
                tr.appendChild(tdGroup2);

                // High Hits
                const tdHighHits = document.createElement('td');
                tdHighHits.textContent = statsData.highHits[i] || 0;
                tr.appendChild(tdHighHits);

                tbody.appendChild(tr);
            }
        } else {
            alert('No data found. Please process a CSV file first.');
        }
    </script>
</body>
</html>
