<!DOCTYPE html>
<html>
<head>
  <title>Roulette Random Picker</title>
  <style>
    body {
      background-color: #FFEBCD; /* Light orange background */
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid black;
      padding: 16px; /* Increased padding */
      text-align: center;
    }
    th {
      color: white; /* White text color for header rows */
    }
    .green-header {
      background-color: green; /* Green background for header 0 and 00 */
      color: white; /* White text color for green headers */
    }
    .black-header {
      background-color: black; /* Black background for specific headers */
      color: white; /* White text color for black headers */
    }
    .red-header {
      background-color: red; /* Red background for specific headers */
      color: white; /* White text color for red headers */
    }
    .bold {
      font-weight: bold;
    }
    .caption {
      text-align: center;
      font-weight: bold;
      display: block;
    }
    .table-container {
      text-align: center;
    }
    .black {
      color: black; /* Black text color for "-" cells */
    }
    .caption#TotalsCaption {
      text-align: center;
    }
    .times-picked-caption {
      font-weight: bold;
      text-align: center; 
    }
    .green {
      background-color: lightgreen; /* Light green background for even numbers */
    }
    .red {
      background-color: lightcoral; /* Light red background for odd numbers */
    }
    .no-value {
      color: black; /* Black text color for cells with no value */
    }

    /* Add this style for Totals table content */
    #TotalsTable td {
      background-color: lightgray; /* Light gray for content cells in the Totals table */
    }

    /* Blinking animation */
    @keyframes blink {
      0% { background-color: white; }
      50% { background-color: gray; }
      100% { background-color: white; }
    }

    /* Apply blinking animation to cell */
    .blink-bg {
      animation: blink 0.5s infinite;
    }

    /* CSS animation for spinning the image */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Apply animation to the image */
    .spin {
      animation: spin 2s linear infinite; /* Faster spinning animation */
    }

    /* Double height for content cells */
    .double-height {
      height: 48px; /* Adjust height as needed */
    }
  </style>
</head>
<body>
<div>
  <center><h1>Roulette Random Picker</h1><img id="rouletteWheel" src="rouwheel.png">&nbsp;&nbsp;<img src="roufield.png"></center><br>
</div>
  <center>
    <button onclick="runSimulation()" style="color:red"><b>Run Simulation</b></button><br><br>
    <label style="color:red" for="x">NUMBER OF RUNS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
    <input type="number" id="x" name="x" value="0" style="width: 100px"><br>
    <label style="color:red" for="y">NUMBER OF SETS PER RUN:&nbsp;</label>
    <input type="number" id="y" name="y" value="14" style="width: 100px"><br><br>
  </center>
  
  <center>
    <button onclick="multiSpin()" style="color:green"><b>Multi-Spin</b></button><br><br>
    <label style="color:green" for="numSpins">NUMBER OF SPINS:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
    <input type="number" id="numSpins" name="numSpins" value="1" style="width: 100px"><br>
    <label style="color:green" for="spinDelay">SPIN DELAY (seconds):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
    <input type="number" id="spinDelay" name="spinDelay" value="1" style="width: 100px"><br>
  </center>
<br>
  <center>

    <button onclick="singleSpin()"><b>Single Spin</b></button>&nbsp; &nbsp; <button id="saveDataButton" style="margin-left: 10px;"><b>Save Data</b></button>
  </center>
  <pre id="output"></pre>

  <div class="table-container">
    <p class="bold caption">TOTAL TIMES PICKED ACROSS ALL RUNS</p>
    <div id="TotalsTableContainer"></div>
  </div>
  <br> <!-- Added a blank line -->

  <!-- Add an audio element for the clicking sound -->
  <audio id="clickSound" src="clicking.wav"></audio>

  <script>
    // Define the variables
    let Totals = new Array(38).fill(0);

    // Function to clear all arrays
    function clearArrays() {
      Totals = new Array(38).fill(0);
    }

    // Function to generate a formatted timestamp
    function getFormattedTimestamp() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      return `${year}-${month}-${day}-${hours}-${minutes}-${seconds}`;
    }

    // Function to export Totals array data to CSV format
    function exportTotalsToCSV(array, filename) {
      let csvContent = "data:text/csv;charset=utf-8,";
      csvContent += ","; // Empty cell to align with headers

      // Loop through Totals array to append values
      for (let j = 0; j < array.length; j++) {
        csvContent += array[j] + ",";
      }
      csvContent += "\n";

      // Encode and create a download link
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `Totals_data_${getFormattedTimestamp()}.csv`);
      document.body.appendChild(link); // Required for Firefox
      link.click(); // Trigger the download
    }

    // Event listener for the Save Data button
    document.getElementById("saveDataButton").addEventListener("click", function() {
      exportTotalsToCSV(Totals, 'totals_data.csv');
    });

    // Function to play the clicking sound
    function playClickSound() {
      const audio = document.getElementById('clickSound');
      audio.currentTime = 0; // Reset playback position
      audio.play();
    }

    // Function to run a single spin
    function singleSpin() {
      clearArrays(); // Clear arrays before single spin
      document.getElementById('TotalsTableContainer').innerHTML = ''; // Clear Totals table container
      document.getElementById('rouletteWheel').classList.add('spin'); // Add spinning animation class to the image
      document.getElementById('TotalsTableContainer').style.display = 'block'; // Display Totals table container

      playClickSound(); // Play clicking sound

      setTimeout(function() {
        document.getElementById('rouletteWheel').classList.remove('spin'); // Remove spinning animation class after spinning
        let c1 = Math.floor(Math.random() * 38); // Generate random number 0-37
        Totals[c1] += 1; // Increment corresponding index in Totals array
        populateTotalsTable(); // Populate Totals table after spinning stops
      }, 2000); // 2000 milliseconds = 2 seconds (faster spinning)
    }

    // Function to run the simulation
    function runSimulation() {
      clearArrays(); // Clear arrays before simulation
      document.getElementById('TotalsTableContainer').innerHTML = ''; // Clear Totals table container
      document.getElementById('rouletteWheel').classList.add('spin'); // Add spinning animation class to the image
      document.getElementById('TotalsTableContainer').style.display = 'block'; // Display Totals table container

      playClickSound(); // Play clicking sound

      let runs = parseInt(document.getElementById('x').value);
      let setsPerRun = parseInt(document.getElementById('y').value);
      let totalSpins = runs * setsPerRun;
      let spinsDone = 0;

      function performSpin() {
        if (spinsDone < totalSpins) {
          setTimeout(function() {
            let c1 = Math.floor(Math.random() * 38); // Generate random number 0-37
            Totals[c1] += 1; // Increment corresponding index in Totals array
            spinsDone++;
            performSpin(); // Continue spinning
          }, 2000); // 2000 milliseconds = 2 seconds (faster spinning)
        } else {
          document.getElementById('rouletteWheel').classList.remove('spin'); // Ensure spinning animation is stopped
          populateTotalsTable(); // Populate Totals table after all spins are done
        }
      }

      performSpin(); // Start the simulation
    }

    // Function to perform multiple spins
    function multiSpin() {
      clearArrays(); // Clear arrays before multi-spin
      document.getElementById('TotalsTableContainer').innerHTML = ''; // Clear Totals table container
      document.getElementById('rouletteWheel').classList.add('spin'); // Add spinning animation class to the image
      document.getElementById('TotalsTableContainer').style.display = 'block'; // Display Totals table container

      playClickSound(); // Play clicking sound

      let numSpins = parseInt(document.getElementById('numSpins').value);
      let spinDelay = parseInt(document.getElementById('spinDelay').value) * 1000; // Convert seconds to milliseconds
      let spinsDone = 0;

      function performSpin() {
        if (spinsDone < numSpins) {
          setTimeout(function() {
            document.getElementById('rouletteWheel').classList.remove('spin'); // Remove spinning animation class
            playClickSound(); // Play clicking sound
            let c1 = Math.floor(Math.random() * 38); // Generate random number 0-37
            Totals[c1] += 1; // Increment corresponding index in Totals array
            spinsDone++;
            performSpin(); // Continue spinning
          }, spinDelay); // Delay between spins
        } else {
          document.getElementById('rouletteWheel').classList.remove('spin'); // Ensure spinning animation is stopped
          populateTotalsTable(); // Populate Totals table after all spins are done
        }
      }

      performSpin(); // Start the simulation
    }

    // Function to populate the Totals table
    function populateTotalsTable() {
      let tableContainer = document.getElementById('TotalsTableContainer');
      let table = '<table id="TotalsTable">';
      table += '<tr><th>Number</th><th>Times Picked</th></tr>';
      for (let i = 0; i < Totals.length; i++) {
        table += `<tr><td>${i}</td><td>${Totals[i]}</td></tr>`;
      }
      table += '</table>';
      tableContainer.innerHTML = table;
    }
  </script>
</body>
</html>
