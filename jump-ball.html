<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Data</title>
    <style>
            body {
            background-color: black;
            color: lightgreen;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 1px solid red;
            color: black;
            font-family: Arial, sans-serif;
        }
        th, td {
            border: 1px solid white;
            padding: 8px;
            text-align: center;
            width: 60px;
            font-weight: bold; /* Make text bold */
        }
        th {
            color: white;
        }
        td {
            background-color: lightgray;
        }
        .highlight {
            background-color: lightyellow;
            color: red;
            font-weight: bold;
        }
        .light-red {
            background-color: lightcoral;
            font-weight: bold;
        }
        .default-light-yellow {
            background-color: lightyellow;
        }
        .light-green {
            background-color: lightgreen;
            color: black;
        }
        .light-blue {
            background-color: lightblue;
        }
        .light-orange {
            background-color: orange;
        }
        .violet {
            background-color: violet;
        }
        tr:nth-child(1) th:nth-child(even) {
            background-color: red;
        }
        tr:nth-child(1) th:nth-child(odd) {
            background-color: black;
        }
        th[data-col="0"], th[data-col="00"] {
            background-color: green;
        }
        .red-text {
            color: red;
        }
        button {
            margin: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .default-light-yellow { background-color: lightyellow; }
        .light-red { background-color: lightcoral; }
        .light-blue { background-color: lightblue; }
        .light-orange { background-color: lightsalmon; }
        .light-green { background-color: lightgreen; }
        .violet { background-color: violet; }
    </style>
</head>
<body>
    <input type="file" id="fileInput" multiple>
    <button id="saveButton">Save CSV</button>
    <button id="viewStatsButton">View Stats</button>
    <table id="dataTable"></table>

    <script>
        const table = document.getElementById('dataTable');
        const csvData = [];
        const group1Columns = [/* define group 1 column indices */];
        const group2Columns = [/* define group 2 column indices */];
        let headerIndices = []; // To track header indices
        let statsData = { group1: 0, group2: 0, highHits: 0 };

        document.getElementById('fileInput').addEventListener('change', function(event) {
            const files = Array.from(event.target.files);
            const reader = new FileReader();

            function processFile(file) {
                reader.onload = function(e) {
                    const lines = e.target.result.split('\n').map(line => line.split(','));

                    // Process header to establish column order
                    headerIndices = lines[0].map((header, index) => index); 
                    
                    // Skip header row for data processing
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].some(cell => cell.trim())) {
                            csvData.push(lines[i].map(cell => cell.trim()));
                        }
                    }

                    if (files.length > 0) {
                        processFile(files.shift());
                    } else {
                        populateTable();
                    }
                };

                reader.readAsText(file);
            }

            function populateTable() {
                csvData.forEach(row => {
                    const tr = document.createElement('tr');
                    let group1Sum = 0;
                    let group2Sum = 0;
                    let group1Cells = [];
                    let group2Cells = [];

                    headerIndices.forEach(index => {
                        const td = document.createElement('td');
                        const cellValue = index >= 0 ? row[index] : '';
                        td.textContent = cellValue;

                        if (index >= 0 && (group1Columns.includes(index) || group2Columns.includes(index))) {
                            td.classList.add('default-light-yellow');
                        }

                        if (index >= 0 && group1Columns.includes(index)) {
                            group1Cells.push(td);
                            if (!isNaN(cellValue)) {
                                group1Sum += Number(cellValue);
                            }
                        }

                        if (index >= 0 && group2Columns.includes(index)) {
                            group2Cells.push(td);
                            if (!isNaN(cellValue)) {
                                group2Sum += Number(cellValue);
                            }
                        }

                        if (!isNaN(cellValue) && Number(cellValue) >= 5) {
                            td.classList.remove('highlight', 'default-light-yellow', 'light-red');
                            td.classList.add('light-green');
                        }

                        tr.appendChild(td);
                    });

                    // Apply background color based on the sum conditions
                    applyBackgroundColor(group1Cells, group1Sum);
                    applyBackgroundColor(group2Cells, group2Sum);

                    table.appendChild(tr);
                });
            }

            function applyBackgroundColor(cells, sum) {
                cells.forEach(td => {
                    if (sum === 8) {
                        td.classList.remove('default-light-yellow');
                        td.classList.add('light-red');
                    } else if (sum === 9) {
                        if (!td.classList.contains('light-green')) {
                            td.classList.remove('default-light-yellow');
                            td.classList.add('light-blue');
                        }
                    } else if (sum === 10) {
                        if (!td.classList.contains('light-green')) {
                            td.classList.remove('default-light-yellow');
                            td.classList.add('light-orange');
                        }
                    } else if (sum === 11) {
                        if (!td.classList.contains('light-green')) {
                            td.classList.remove('default-light-yellow');
                            td.classList.add('violet');
                        }
                    }
                });
            }

            document.getElementById('saveButton').addEventListener('click', function() {
                const csvContent = tableToCSV();
                downloadCSV('output.csv', csvContent);
            });

            document.getElementById('viewStatsButton').addEventListener('click', function() {
                localStorage.setItem('statsData', JSON.stringify(statsData));
                window.location.href = 'view-stats.html';
            });

            if (files.length > 0) {
                processFile(files.shift());
            }
        });

        function tableToCSV() {
            const rows = Array.from(table.querySelectorAll('tr'));
            const csvContent = rows.map(row => 
                Array.from(row.querySelectorAll('th, td'))
                    .map(cell => `"${cell.textContent.replace(/"/g, '""')}"`)
                    .join(',')
            ).join('\n');

            return csvContent;
        }

        function downloadCSV(filename, csvContent) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    </script>
</body>
</html>
