<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roulette Wheels</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      padding: 10px;
      box-sizing: border-box;
    }

    .wheels-container {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .wheel-container {
      border: 5px solid #fff;
      border-radius: 50%;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 635px;
      height: 635px;
      max-width: 100%;
      max-height: 100vh;
      box-sizing: border-box;
    }

    #output1, #output2 {
      width: 100%;
      height: 100%;
    }

    .button-container {
      text-align: center;
      margin-bottom: 20px;
    }

    .button {
      padding: 10px 16px;
      background: #fff;
      border: none;
      cursor: pointer;
      margin: 5px;
      font-size: 18px;
    }

    #startButton1 {
      background-color: #4CAF50;
      color: white;
    }

    #startButton2 {
      background-color: #FF5722;
      color: white;
    }

    #saveDataButton {
      background-color: #f44336;
      color: white;
    }

    #accessSimulatorButton {
      background-color: #008CBA;
      color: white;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
    }

    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
      font-weight: bold;
      color: black;
      width: 50px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      min-height: 30px;
      min-width: 50px;
    }

    th {
      color: white;
    }

    .green-header {
      background-color: green;
      color: white;
    }

    .black-header {
      background-color: black;
      color: white;
    }

    .red-header {
      background-color: red;
      color: white;
    }

    .green, .red, .black {
      background-color: lightgray;
    }

    .lgreen-text {
      color: lightgreen;
      text-align: center;
    }

    #TotalsTableContainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: auto;
    }

    .blink {
      animation: blink 1s step-start infinite;
    }

    @keyframes blink {
      0% { background-color: white; }
      50% { background-color: lightgray; }
      100% { background-color: white; }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .spin {
      animation: spin 2s linear infinite;
    }

    @media (max-width: 768px) {
      .wheel-container {
        padding: 5px;
        width: 90%;
        height: auto;
      }

      .button {
        font-size: 16px;
        padding: 8px;
      }

      table {
        width: 100%;
        max-width: none;
      }

      th, td {
        font-size: 12px;
        padding: 6px;
      }

      .caption {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .wheel-container {
        width: 100%;
        height: auto;
      }

      .button {
        font-size: 14px;
        padding: 6px;
      }

      .caption {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div>
    <h1 class="lgreen-text">Roulette Wheels</h1>
  </div>
  <div class="wheels-container">
    <div class="wheel-container">
      <div id="output1"></div>
    </div>
    <div class="wheel-container">
      <div id="output2"></div>
    </div>
  </div>
  <br>
  <div class="button-container">
    <button id="startButton1" class="button"><b>Spin Wheel 1</b></button>
    <button id="startButton2" class="button"><b>Spin Wheel 2</b></button>
    <button id="saveDataButton" class="button"><b>Save Data</b></button>
    <button id="accessSimulatorButton" class="button"><b>Access Simulator</b></button>
  </div>

  <div class="table-container">
    <p class="bold caption">TOTAL TIMES PICKED</p>
    <div id="TotalsTableContainer"></div>
  </div>
  <br><br>

  <script>
    function createWheelSketch(canvasId, startButtonId) {
      return function(p) {
        let wheelRadius = 280;
        let wheelCenterX;
        let wheelCenterY;
        let ballRadius = 14;
        let ballX;
        let ballY;
        let ballSpeed;
        let ballAngle;
        let ballFriction = .9945;
        let isSpinning = false;
        let minSpeed = .85;
        let finalIndex;
        let winningNumber;
        let numSlots = 38;
        let slotNumbers = [18, 6, 21, 33, 16, 4, 23, 35, 14, 2, 0, 28, 9, 26, 30, 11, 7, 20, 32, 17, 5, 22, 34, 15, 3, 24, 36, 13, 1, '00', 27, 10, 25, 29, 12, 8, 19, 31];
        let slotAngle;
        let wheelSound;
        let soundLoaded = false;
        let Totals = new Array(38).fill(0);

        p.setup = function() {
          p.createCanvas(600, 600).parent(canvasId);
          wheelCenterX = p.width / 2;
          wheelCenterY = p.height / 2;
          slotAngle = 360 / numSlots;
          document.getElementById(startButtonId).addEventListener('click', () => {
            startWheelSpin();
          });
          loadAndPlaySound();
        }

        p.draw = function() {
          p.background(0);
          drawWheel();

          if (isSpinning) {
            ballAngle += ballSpeed;
            ballSpeed *= ballFriction;

            if (ballSpeed < minSpeed) {
              isSpinning = false;
              finalIndex = calculateSlotIndex();
              winningNumber = slotNumbers[finalIndex];
              moveBallToWinningSlot();

              if (wheelSound) {
                wheelSound.stop();
              }

              if (winningNumber !== undefined) {
                let index = slotNumbers.indexOf(winningNumber);
                Totals[index]++;
                populateTotalsTable();
              }
            }

            ballX = wheelCenterX + (wheelRadius - ballRadius) * Math.cos(p.radians(ballAngle));
            ballY = wheelCenterY + (wheelRadius - ballRadius) * Math.sin(p.radians(ballAngle));
          }

          p.fill(255);
          p.ellipse(ballX, ballY, ballRadius * 2, ballRadius * 2);
        }

        function drawWheel() {
          p.noStroke();
          for (let i = 0; i < numSlots; i++) {
            let angleStart = i * slotAngle * Math.PI / 180;
            let angleEnd = (i + 1) * slotAngle * Math.PI / 180;

            if (slotNumbers[i] === 0 || slotNumbers[i] === '00') {
              p.fill(0, 128, 0);
            } else {
              p.fill(i % 2 === 0 ? p.color(255, 0, 0) : p.color(0));
            }

            p.arc(wheelCenterX, wheelCenterY, wheelRadius * 2, wheelRadius * 2, angleStart, angleEnd, p.PIE);

            let midAngle = (angleStart + angleEnd) / 2;
            let x = wheelCenterX + (wheelRadius - 30) * Math.cos(midAngle);
            let y = wheelCenterY + (wheelRadius - 30) * Math.sin(midAngle);

            p.fill(255);
            p.textAlign(p.CENTER, p.CENTER);
            p.textSize(16);
            p.text(slotNumbers[i], x, y);
          }
        }

        function calculateSlotIndex() {
          let normalizedAngle = (ballAngle % 360 + 360) % 360;
          let anglePerSlot = 360 / numSlots;
          let index = Math.floor(normalizedAngle / anglePerSlot) % numSlots;
          return index;
        }

        function moveBallToWinningSlot() {
          if (!isSpinning) {
            let centerAngle = (finalIndex + 0.5) * slotAngle;
            let correctedAngle = (360 - centerAngle + 360) % 360;

            ballX = wheelCenterX + (wheelRadius - ballRadius) * Math.cos(p.radians(correctedAngle));
            ballY = wheelCenterY + (wheelRadius - ballRadius) * Math.sin(p.radians(correctedAngle));
          }
        }

        function loadAndPlaySound() {
          wheelSound = new Howl({
            src: ['wheel-ball.wav'], // Path to your local audio file
            loop: true,
            onload: () => {
              soundLoaded = true;
              console.log('Sound loaded');
            },
            onloaderror: (id, error) => {
              console.error('Sound loading error:', error);
            },
            onplayerror: (id, error) => {
              console.error('Sound play error:', error);
            }
          });
        }

        function startWheelSpin() {
          if (!isSpinning) {
            if (soundLoaded) {
              wheelSound.play();
            } else {
              console.error('Sound not loaded');
            }
            isSpinning = true;
            ballAngle = p.random(360);
            ballSpeed = p.random(5, 10);
          }
        }

        function populateTotalsTable() {
          let tableContainer = document.getElementById('TotalsTableContainer');
          let tableHTML = '<table id="TotalsTable"><thead><tr>';

          // Header Row
          for (let i = 0; i < numSlots; i++) {
            let colorClass = (slotNumbers[i] === 0 || slotNumbers[i] === '00') ? 'green-header' :
                             (i % 2 === 0 ? 'red-header' : 'black-header');
            tableHTML += `<th class="${colorClass}">${slotNumbers[i]}</th>`;
          }

          tableHTML += '</tr></thead><tbody><tr>';

          // Data Row
          for (let i = 0; i < numSlots; i++) {
            let colorClass = (slotNumbers[i] === 0 || slotNumbers[i] === '00') ? 'green' :
                             (i % 2 === 0 ? 'red' : 'black');
            let displayValue = Totals[i] > 0 ? Totals[i] : '&nbsp;';
            let cellClass = i === finalIndex ? 'blink' : '';
            tableHTML += `<td class="${colorClass} ${cellClass}">${displayValue}</td>`;
          }

          tableHTML += '</tr></tbody></table>';

          tableContainer.innerHTML = tableHTML;
        }

        function clearAndResetTotals() {
          Totals.fill(0);
          populateTotalsTable();
        }

        function exportTotalsToCSV(data, filename) {
          const csvContent = "data:text/csv;charset=utf-8,"
              + "Number,Frequency\n"
              + data.map((freq, index) => `${slotNumbers[index]},${freq}`).join("\n");
          
          const encodedUri = encodeURI(csvContent);
          const link = document.createElement("a");
          link.setAttribute("href", encodedUri);
          link.setAttribute("download", filename);
          document.body.appendChild(link);
          link.click();
        }
      }
    }

    // Create p5.js sketches for both wheels
    new p5(createWheelSketch('output1', 'startButton1'));
    new p5(createWheelSketch('output2', 'startButton2'));
  </script>
</body>
</html>
