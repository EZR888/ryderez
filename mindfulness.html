<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mindfulness Coach: Brought to you by AI</title>
  <style>
    :root {
      --bg: #e4f0e7;           /* muted green page background */
      --panel: #fffbe6;        /* light yellow cards */
      --accent: #2e7d5b;       /* deep green */
      --accent-2: #9cc5af;     /* soft green */
      --text: #1f2933;         /* slate */
      --muted: #6b7a86;        /* muted text */
      --bubble-user: #e9f7ff;  /* user bubble */
      --bubble-sophia: #eef7f0;/* sophia bubble */
      --input-bg: #f5f5f5;     /* light gray for inputs & chat areas */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      line-height: 1.45;
    }

    .shell {
      display: grid;
      grid-template-columns: 2fr 1fr; /* left 2/3, right 1/3 */
      gap: 20px;
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 16px;
    }

    .card {
      background: var(--panel);
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      border: 1px solid #e6ece8;
    }

    .left { padding: 24px; display: grid; gap: 20px; }
    .intro h1 { margin: 0 0 8px; font-size: 28px; color: var(--accent); }
    .intro h2 { margin: 8px 0 12px; font-size: 20px; }
    .intro p, .intro li { color: var(--text); }

    .form h3 { margin: 0 0 12px; color: var(--accent); }
    .row { display: grid; grid-template-columns: 220px 1fr; align-items: start; gap: 12px; margin: 10px 0; }
    input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 10px; border: 1px solid #d3e2d9; border-radius: 10px; background: var(--input-bg); }
    textarea { resize: vertical; min-height: 90px; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 4px; }

    .right { display: grid; grid-template-rows: auto 1fr; overflow: hidden; }
    .avatar-wrap { padding: 16px; border-bottom: 1px solid #e6ece8; }
    .avatar-card { background: var(--panel); border-radius: 14px; overflow: hidden; border: 1px solid #e6ece8; text-align: center; }
    .avatar-card img { max-width: 100%; height: auto; display: block; }
    .avatar-caption { padding: 10px; color: var(--muted); font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
    .mode-pill { background: var(--accent-2); color: #0e3b2a; border-radius: 999px; padding: 2px 8px; font-size: 11px; font-weight: 700; }

    .chat { display: grid; grid-template-rows: 1fr auto; }
    .log { padding: 16px; overflow: auto; background: var(--input-bg); }
    .msg { max-width: 85%; margin: 8px 0; padding: 10px 12px; border-radius: 12px; border: 1px solid #e2eadf; white-space: pre-wrap; }
    .msg.sophia { background: var(--bubble-sophia); }
    .msg.user { background: var(--bubble-user); margin-left: auto; }
    .msg .by { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }

    .composer { display: grid; grid-template-columns: 1fr auto; gap: 10px; padding: 12px; border-top: 1px solid #e6ece8; background: var(--input-bg); }
    button { padding: 10px 14px; border: 0; border-radius: 10px; background: var(--accent); color: white; font-weight: 600; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
      .radio-group { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    input[type="radio"] { width: auto; margin-right: 6px; accent-color: var(--accent); }
  </style>
</head>
<body>
  <header style="max-width:1200px;margin:0 auto 8px;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;">
    <div style="font-weight:800;color:var(--accent);">Mindfulness Coach: Brought to you by AI</div>
    <div style="background:var(--accent-2);padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;">Dashboard</div>
  </header>

  <main class="shell">
    <!-- LEFT: Intro + Form -->
    <section class="left card">
      <div class="intro">
        <h1>What is mindfulness?</h1>
        <p>Mindfulness is a practice or set of practices that develop the capacity for a calm, focused mind that is open, responsive and sensitive for optimal teaching, advising, management, and learning. Based on neuroscientific research, mindfulness has been shown to help participants reduce stress and revitalize their professional and personal lives by promoting awareness, presence, compassion, concentration, and focus.</p>
        <h2>Those who practice mindfulness often report</h2>
        <ul>
          <li>Feeling more positive</li>
          <li>Reduced emotional reactivity</li>
          <li>Cultivation of compassion</li>
          <li>Minimized drama</li>
          <li>Lowered stress levels</li>
          <li>Appreciation for small things</li>
          <li>Greater connection to goals</li>
        </ul>
        <p>In practicing mindfulness, we invite ourselves to notice experiences as they unfold from moment to moment.</p>
      </div>

      <form class="form" id="intakeForm" onsubmit="return false;">
        <h3>Let's begin</h3>
        <div class="row">
          <label for="name">Your name</label>
          <div>
            <input id="name" type="text" maxlength="25" placeholder="e.g., Alex">
            <div class="hint">Max 25 characters.</div>
          </div>
        </div>
        <div class="row">
          <label for="why">Why mindfulness?</label>
          <div>
            <textarea id="why" maxlength="500" placeholder="What brings you here today? Up to 500 chars..."></textarea>
            <div class="hint"><span id="whyCount">0</span>/500</div>
          </div>
        </div>
        <div class="row"><label>Practiced before?</label>
          <div class="radio-group">
            <label><input type="radio" name="practiced" value="Yes"> Yes</label>
            <label><input type="radio" name="practiced" value="No"> No</label>
          </div>
        </div>
        <div class="row"><label for="effectiveness">Effectiveness (1–10)</label><input id="effectiveness" type="number" min="1" max="10"></div>
        <div class="row"><label for="frequency">Frequency</label>
          <select id="frequency">
            <option value="">Choose…</option>
            <option>daily</option>
            <option>weekly</option>
            <option>no set schedule</option>
          </select>
        </div>
        <div class="row"><label></label><button id="saveBtn" type="button">Save to Chat</button></div>
      </form>
    </section>

    <!-- RIGHT: Avatar + Chat -->
    <aside class="right card">
      <div class="avatar-wrap">
        <div class="avatar-card">
          <img src="mind.png" alt="Sophia - mindfulness coach avatar">
          <div class="avatar-caption"><strong>Sophia</strong> — Mindfulness Coach <span class="mode-pill" id="modePill">AI: Demo</span></div>
        </div>
      </div>

      <div class="chat">
        <div id="log" class="log" aria-live="polite"></div>
        <div class="composer">
          <input id="prompt" type="text" placeholder="Type your message… (Enter to send)" style="background:var(--input-bg);">
          <button id="send">Send</button>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // ====== Elements
    const log = document.getElementById('log');
    const sendBtn = document.getElementById('send');
    const promptInput = document.getElementById('prompt');
    const nameInput = document.getElementById('name');
    const whyInput = document.getElementById('why');
    const whyCount = document.getElementById('whyCount');
    const saveBtn = document.getElementById('saveBtn');
    const modePill = document.getElementById('modePill');

    // Character counter for the textarea
    whyInput.addEventListener('input', () => whyCount.textContent = String(whyInput.value.length));

    // ====== Minimal chat state + persona
    const messages = [];
    const coachName = 'Sophia';
    const systemPrompt = `You are ${coachName}, a warm, practical mindfulness coach. Keep replies short (2–6 sentences), specific, and action‑oriented. Avoid medical claims. Offer gentle prompts: breath, grounding, labeling thoughts, body scan. Mirror the user's words once, then propose a next step. If the user wants to begin a practice, give a simple timed protocol (e.g., 4‑2‑6 breathing) and a one‑line debrief question.`;

    function escapeHTML(s) { return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }

    function addMsg(by, text, role) {
      const el = document.createElement('div');
      el.className = `msg ${role}`;
      el.innerHTML = `<span class="by">${escapeHTML(by)}</span>${escapeHTML(text)}`;
      log.appendChild(el);
      log.scrollTop = log.scrollHeight;
    }

    function userLabel(){ return (nameInput.value || '').trim() || 'You'; }

    // Greet on load
    addMsg(coachName, 'Hi, my name is Sophia and I will be guiding you through this mindfulness exercise.', 'sophia');

    // ====== API scaffold (plug your AI here)
    // Toggle this to false once you wire a real API.
    const DEMO_MODE = true;

    async function callAI(chatMessages) {
      if (DEMO_MODE) {
        modePill.textContent = 'AI: Demo';
        return mockCoach(chatMessages);
      }

      modePill.textContent = 'AI: Live';

      // --- Example: OpenAI Responses API (browser fetch to your own backend) ---
      // IMPORTANT: Do NOT put secrets in client code. Create a small server endpoint
      // at /api/coach that forwards to your provider (OpenAI/Anthropic/etc.).
      // return fetch('/api/coach', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ messages: chatMessages })
      // }).then(r => r.json()).then(d => d.reply);

      // --- Example: RetellAI (you would exchange messages with their session) ---
      // return fetch('/api/retell-session', { method: 'POST', body: JSON.stringify({ messages: chatMessages }) })
      //   .then(r => r.json()).then(d => d.reply);
    }

    // Simple rule-based fallback so the page works standalone.
    function mockCoach(chatMessages){
      const last = chatMessages[chatMessages.length - 1]?.content?.toLowerCase() || '';
      if (/begin|start/.test(last)) {
        return 'Great. Sit comfortably. Inhale 4, hold 2, exhale 6 — for 8 rounds. If distracted, label the thought “thinking” and return to breath. Afterward, type one word for how you feel.';
      }
      if (/stress|anx|overwhelm|panic/.test(last)) {
        return 'I hear stress is present. Try three rounds of 4‑2‑6 breathing. On each exhale, soften the jaw and shoulders. What do you notice now?';
      }
      if (/sleep|insomnia|tired/.test(last)) {
        return 'For sleep, try a 4‑7‑8 cycle for two minutes, then a brief body scan from toes to head. Keep the breath gentle. Would you like a 2‑minute audio-style script?';
      }
      if (/focus|distraction|productivity|work/.test(last)) {
        return 'To boost focus, do a 60‑second anchor: feel the breath at the nostrils, then note “hearing/seeing/thinking” as sensations pass. Ready to try a 1‑minute focus drill?';
      }
      if (/anger|sad|grief|frustrat/.test(last)) {
        return 'Noted. Place a palm on the chest; breathe slowly for six breaths. Name the emotion out loud once. Ask: “What does this part of me need?” Tell me what comes up.';
      }
      return 'Thanks for sharing. Let’s do one small step: take three slow breaths (inhale 4, hold 1, exhale 6). What changed, even slightly?';
    }

    // Build a message block the backend LLMs expect
    function toLLMMessages() {
      const base = [{ role:'system', content: systemPrompt }];
      return base.concat(messages);
    }

    // ====== Intake -> personalized response
    saveBtn.addEventListener('click', async () => {
      const practiced = (document.querySelector('input[name="practiced"]:checked') || {}).value || '—';
      const eff = (document.getElementById('effectiveness').value || '—');
      const freq = (document.getElementById('frequency').value || '—');

      const summary = `Name: ${userLabel()}\nWhy mindfulness: ${whyInput.value.trim() || '—'}\nPracticed before: ${practiced}\nEffectiveness: ${eff}\nFrequency: ${freq}`;
      addMsg('Intake Summary', summary, 'sophia');

      // Push a single “user” message summarizing the profile
      messages.push({ role: 'user', content: `Profile — name: ${userLabel()}; reason: ${whyInput.value.trim() || 'n/a'}; practiced: ${practiced}; effectiveness: ${eff}; frequency: ${freq}. Please reflect briefly and propose the next small step.` });

      const reply = await callAI(toLLMMessages());
      messages.push({ role: 'assistant', content: reply });
      addMsg(coachName, reply, 'sophia');
    });

    // ====== Chat -> AI
    async function sendUserMessage() {
      const val = promptInput.value.trim();
      if (!val) return;
      addMsg(userLabel(), val, 'user');
      messages.push({ role: 'user', content: val });
      promptInput.value = '';

      const reply = await callAI(toLLMMessages());
      messages.push({ role: 'assistant', content: reply });
      addMsg(coachName, reply, 'sophia');
    }

    sendBtn.addEventListener('click', sendUserMessage);
    promptInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendUserMessage(); } });
  </script>
</body>
</html>
